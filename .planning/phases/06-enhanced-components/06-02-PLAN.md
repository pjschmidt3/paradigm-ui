---
phase: 06-enhanced-components
plan: 02
type: execute
---

<objective>
Add size variants and status indicator to Avatar, plus closable variant to Badge.

Purpose: Complete the enhanced component set with Avatar improvements and removable badges.
Output: Enhanced Avatar and Badge components with new features, tests, and Phase 6 complete.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./06-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-enhanced-components/06-01-SUMMARY.md
@src/components/ui/avatar.tsx
@src/components/ui/badge.tsx
@.planning/codebase/CONVENTIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add size variants to Avatar</name>
  <files>src/components/ui/avatar.tsx, registry/new-york/ui/__tests__/avatar.test.tsx</files>
  <action>
    Refactor Avatar to use CVA for size variants:
    - xs: 'size-6' (24px)
    - sm: 'size-7' (28px)
    - default: 'size-8' (32px, current)
    - lg: 'size-10' (40px)
    - xl: 'size-12' (48px)

    Update Avatar props to accept `size?: 'xs' | 'sm' | 'default' | 'lg' | 'xl'`.
    Export avatarVariants for external use.
    Add data-size attribute to avatar element.

    Create avatar.test.tsx with tests for:
    - Avatar renders with default size
    - Avatar renders each size variant correctly
    - AvatarImage and AvatarFallback work with sized Avatar
  </action>
  <verify>npm test -- avatar.test.tsx passes</verify>
  <done>Avatar accepts size prop with 5 options (xs, sm, default, lg, xl)</done>
</task>

<task type="auto">
  <name>Task 2: Add status indicator to Avatar</name>
  <files>src/components/ui/avatar.tsx, registry/new-york/ui/__tests__/avatar.test.tsx</files>
  <action>
    Create AvatarStatus component for online/offline/away indicators:

    ```tsx
    const avatarStatusVariants = cva(
      'absolute bottom-0 right-0 rounded-full border-2 border-background',
      {
        variants: {
          status: {
            online: 'bg-green-500',
            offline: 'bg-gray-400',
            away: 'bg-yellow-500',
            busy: 'bg-red-500'
          },
          size: {
            xs: 'size-1.5',
            sm: 'size-2',
            default: 'size-2.5',
            lg: 'size-3',
            xl: 'size-3.5'
          }
        },
        defaultVariants: { status: 'offline', size: 'default' }
      }
    )
    ```

    Usage: `<Avatar><AvatarImage /><AvatarStatus status="online" /></Avatar>`

    Add tests for AvatarStatus rendering with each status.
  </action>
  <verify>npm test -- avatar.test.tsx passes</verify>
  <done>AvatarStatus component shows colored dot indicator for user status</done>
</task>

<task type="auto">
  <name>Task 3: Add closable Badge variant</name>
  <files>src/components/ui/badge.tsx, registry/new-york/ui/__tests__/badge.test.tsx</files>
  <action>
    Add closable functionality to Badge:

    1. Add `onRemove?: () => void` prop to Badge
    2. When onRemove provided, render X button after children:
       - Use X icon from lucide-react (size matches badge size)
       - Button has hover state, calls onRemove on click
       - Prevent event propagation on click

    Styling for close button:
    - 'ml-1 -mr-0.5 hover:bg-black/10 dark:hover:bg-white/10 rounded-full p-0.5 cursor-pointer'
    - Size-aware: sm uses size-2.5, default size-3, lg size-3.5

    Add tests for:
    - Badge renders close button when onRemove provided
    - onRemove callback fires on click
    - Badge without onRemove has no close button
  </action>
  <verify>npm test -- badge.test.tsx passes</verify>
  <done>Badge with onRemove prop shows X button that triggers removal callback</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm test` passes all tests
- [ ] `npm run build` succeeds without errors
- [ ] Avatar sizes render correctly
- [ ] AvatarStatus shows colored indicators
- [ ] Badge close button works and calls onRemove
- [ ] All new components registered in registry.json
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Avatar has size prop and AvatarStatus component
- Badge has onRemove prop with close button
- Phase 6 complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-enhanced-components/06-02-SUMMARY.md`

Update STATE.md: Phase 6 complete, ready for Phase 7
Update ROADMAP.md: Mark Phase 6 plans complete
</output>
